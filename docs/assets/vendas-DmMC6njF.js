import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css                  */document.addEventListener("DOMContentLoaded",()=>{const c=localStorage.getItem("token"),u=document.getElementById("venda-lista"),n=document.getElementById("form-venda"),a=document.getElementById("venda-criar-msg");let m=[],p=[];async function y(){try{const t=await fetch("https://store-management-system-xemr.onrender.com/api/user/actives",{headers:{Authorization:`Bearer ${c}`}});if(!t.ok)throw new Error("Erro ao procurar utilizadores");m=(await t.json()).data.users}catch{m=[]}}async function f(){try{const t=await fetch("https://store-management-system-xemr.onrender.com/api/product/active",{headers:{Authorization:`Bearer ${c}`}});if(!t.ok)throw new Error("Erro ao procurar produtos");p=(await t.json()).data.products}catch{p=[]}}function g(t=null){let e='<label>Utilizador: <select name="user_id" required>';return e+='<option value="">Selecione o utilizador</option>',m.forEach(o=>{e+=`<option value="${o.id}"${t==o.id?" selected":""}>${o.name} (${o.email})</option>`}),e+="</select></label><br>",e}function w(t=null){let e='<label>Produto: <select name="product_id" required>';return e+='<option value="">Selecione o produto</option>',p.forEach(o=>{e+=`<option value="${o.id}"${t==o.id?" selected":""}>${o.name}</option>`}),e+="</select></label><br>",e}async function h(){try{const t=await fetch("https://store-management-system-xemr.onrender.com/api/sale/list",{headers:{Authorization:`Bearer ${c}`}});if(!t.ok)throw new Error("Erro ao procurar vendas");const o=(await t.json()).data.sales;if(console.log(o),!Array.isArray(o)||o.length===0){u.innerHTML="<p>Nenhuma venda encontrada.</p>";return}let s='<table style="width:100%;border-collapse:collapse;margin-top:1rem;">';s+="<tr><th>ID</th><th>Utilizador</th><th>Produto</th><th>Quantidade</th><th>Cliente</th><th>Total (€)</th></tr>",o.forEach(r=>{const i=r.user&&r.user.name?r.user.name:"-",d=r.product&&r.product.name?r.product.name:"-",l=r.customer&&r.customer.name?r.customer.name:r.customer||"-";s+=`<tr>
          <td>${r.id}</td>
          <td>${i}</td>
          <td>${d}</td>
          <td>${r.quantity}</td>
          <td>${l}</td>
          <td>${r.total_value!==void 0?r.total_value:"-"}</td>
        </tr>`}),s+="</table>",u.innerHTML=s}catch{u.innerHTML='<p style="color:red;">Erro ao procurar vendas.</p>'}}n.addEventListener("submit",async t=>{t.preventDefault(),a.textContent="";const e=n.customer.value.trim(),o=n.user_id.value,s=n.product_id.value,r=n.quantity.value;if(!o||!s||!r){a.textContent="Utilizador, produto e quantidade são obrigatórios.",a.style.color="red";return}try{const i={user_id:o,product_id:s,quantity:r};e&&(i.customer={name:e});const d=await fetch("https://store-management-system-xemr.onrender.com/api/sale/register",{method:"POST",headers:{Authorization:`Bearer ${c}`,"Content-Type":"application/json"},body:JSON.stringify(i)}),l=await d.json();if(!d.ok){a.textContent=l.message||"Erro ao registar venda.",a.style.color="red";return}a.textContent=l.message||"Venda registrada com sucesso!",a.style.color="green",n.reset(),await h()}catch{a.textContent="Erro ao registar venda.",a.style.color="red"}}),(async()=>{await y(),await f();const t=n.querySelector(".user-select-div");t.innerHTML=g();const e=n.querySelector(".produto-select-div");e.innerHTML=w(),h()})()});
