import"./modulepreload-polyfill-B5Qt9EMX.js";import"./logout-DMNDklZ6.js";document.addEventListener("DOMContentLoaded",()=>{const c=localStorage.getItem("token"),l=document.getElementById("venda-lista"),n=document.getElementById("form-venda"),a=document.getElementById("venda-criar-msg");let m=[],p=[];async function y(){try{const t=await fetch("https://store-management-system-xemr.onrender.com/api/user/actives",{headers:{Authorization:`Bearer ${c}`}});if(!t.ok)throw new Error("Erro ao buscar utilizadores");m=(await t.json()).data.users}catch{m=[]}}async function f(){try{const t=await fetch("https://store-management-system-xemr.onrender.com/api/product/active",{headers:{Authorization:`Bearer ${c}`}});if(!t.ok)throw new Error("Erro ao buscar produtos");p=(await t.json()).data.products}catch{p=[]}}function g(t=null){let e='<label>Utilizador: <select name="user_id" required>';return e+='<option value="">Selecione o utilizador</option>',m.forEach(r=>{e+=`<option value="${r.id}"${t==r.id?" selected":""}>${r.name} (${r.email})</option>`}),e+="</select></label><br>",e}function b(t=null){let e='<label>Produto: <select name="product_id" required>';return e+='<option value="">Selecione o produto</option>',p.forEach(r=>{e+=`<option value="${r.id}"${t==r.id?" selected":""}>${r.name}</option>`}),e+="</select></label><br>",e}async function h(){try{const t=await fetch("https://store-management-system-xemr.onrender.com/api/sale/list",{headers:{Authorization:`Bearer ${c}`}});if(!t.ok)throw new Error("Erro ao buscar vendas");const r=(await t.json()).data.sales;if(!Array.isArray(r)||r.length===0){l.innerHTML="<p>Nenhuma venda encontrada.</p>";return}let s='<table style="width:100%;border-collapse:collapse;margin-top:1rem;">';s+="<tr><th>ID</th><th>Utilizador</th><th>Produto</th><th>Quantidade</th><th>Cliente</th></tr>",r.forEach(o=>{const i=o.user&&o.user.name?o.user.name:"-",d=o.product&&o.product.name?o.product.name:"-",u=o.customer&&o.customer.name?o.customer.name:o.customer||"-";s+=`<tr>
          <td>${o.id}</td>
          <td>${i}</td>
          <td>${d}</td>
          <td>${o.quantity}</td>
          <td>${u}</td>
        </tr>`}),s+="</table>",l.innerHTML=s}catch{l.innerHTML='<p style="color:red;">Erro ao buscar vendas.</p>'}}n.addEventListener("submit",async t=>{t.preventDefault(),a.textContent="";const e=n.customer.value.trim(),r=n.user_id.value,s=n.product_id.value,o=n.quantity.value;if(!r||!s||!o){a.textContent="Utilizador, produto e quantidade são obrigatórios.",a.style.color="red";return}try{const i={user_id:r,product_id:s,quantity:o};e&&(i.customer={name:e});const d=await fetch("https://store-management-system-xemr.onrender.com/api/sale/register",{method:"POST",headers:{Authorization:`Bearer ${c}`,"Content-Type":"application/json"},body:JSON.stringify(i)}),u=await d.json();if(!d.ok){a.textContent=u.message||"Erro ao registrar venda.",a.style.color="red";return}a.textContent=u.message||"Venda registrada com sucesso!",a.style.color="green",n.reset(),await h()}catch{a.textContent="Erro ao registrar venda.",a.style.color="red"}}),(async()=>{await y(),await f();const t=n.querySelector(".user-select-div");t.innerHTML=g();const e=n.querySelector(".produto-select-div");e.innerHTML=b(),h()})()});
