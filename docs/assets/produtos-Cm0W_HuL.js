import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css                  */document.addEventListener("DOMContentLoaded",()=>{const d=localStorage.getItem("token"),m=document.getElementById("produto-lista"),n=document.getElementById("form-produto"),i=document.getElementById("produto-criar-msg");let g=[],p=[];async function E(){try{const e=await fetch("https://store-management-system-xemr.onrender.com/api/category/list",{headers:{Authorization:`Bearer ${d}`}});if(!e.ok)throw new Error("Erro ao procurar categorias");p=(await e.json()).data.categories,console.log("Categorias carregadas:",p)}catch{p=[]}}function h(e=null){let o='<select name="category_id" required>';return o+='<option value="">Selecione a categoria</option>',p.forEach(t=>{console.log("Renderizando categoria:",t),t&&t.id&&t.name&&(o+=`<option value="${t.id}"${e==t.id?" selected":""}>${t.name}</option>`)}),o+="</select>",o}async function l(){try{const e=await fetch("https://store-management-system-xemr.onrender.com/api/product/active",{headers:{Authorization:`Bearer ${d}`}});if(!e.ok)throw new Error("Erro ao procurar produtos");const t=(await e.json()).data.products;if(g=t,!Array.isArray(t)||t.length===0){m.innerHTML="<p>Nenhum produto encontrado.</p>";return}let r='<table style="width:100%;border-collapse:collapse;margin-top:1rem;">';r+="<tr><th>ID</th><th>Nome</th><th>Preço</th><th>Stock</th><th>Categoria</th><th>Ações</th></tr>",t.forEach(a=>{const s=a.category&&a.category.name?a.category.name:"-";r+=`<tr>
          <td>${a.id}</td>
          <td>${a.name}</td>
          <td>${a.price}</td>
          <td>${a.stock_quantity}</td>
          <td>${s}</td>
          <td>
            <button class="editar-btn" data-id="${a.id}">Editar</button>
            <button class="eliminar-btn" data-id="${a.id}">Eliminar</button>
          </td>
        </tr>`}),r+="</table>",m.innerHTML=r,C()}catch{m.innerHTML='<p style="color:red;">Erro ao procurar produtos.</p>'}}function C(){document.querySelectorAll(".editar-btn").forEach(e=>{e.addEventListener("click",o=>{const t=e.getAttribute("data-id");$(t)})}),document.querySelectorAll(".eliminar-btn").forEach(e=>{e.addEventListener("click",async o=>{const t=e.getAttribute("data-id");confirm("Tem certeza que deseja eliminar este produto?")&&await w(t)})})}function $(e){const o=g.find(t=>t.id==e);o&&(m.innerHTML=`
      <h2>Editar Produto</h2>
      <form id="form-editar-produto">
        <label>Nome: <input name="name" value="${o.name}" required /></label><br>
        <label>Preço: <input name="price" type="number" step="0.01" value="${o.price}" required /></label><br>
        <label>Quantidade em Estoque: <input name="stock_quantity" type="number" value="${o.stock_quantity}" required /></label><br>
        <label>Categoria: ${h(o.category?o.category.id:null)}</label><br>
        <button type="submit">Salvar</button>
        <button type="button" id="cancelar-edicao">Cancelar</button>
      </form>
      <div id="editar-produto-msg"></div>
    `,document.getElementById("cancelar-edicao").onclick=l,document.getElementById("form-editar-produto").onsubmit=async t=>{t.preventDefault();const r=t.target,a=r.name.value.trim(),s=r.price.value.trim(),u=r.stock_quantity.value.trim(),f=r.category_id.value,c=document.getElementById("editar-produto-msg");if(c.textContent="",!a||!s||!u||!f){c.textContent="Todos os campos são obrigatórios.",c.style.color="red";return}try{const y=await fetch(`https://store-management-system-xemr.onrender.com/api/product/${e}/update`,{method:"PATCH",headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json"},body:JSON.stringify({name:a,price:s,stock_quantity:u,category_id:f})}),v=await y.json();if(!y.ok){c.textContent=v.message||"Erro ao editar produto.",c.style.color="red";return}c.textContent=v.message||"Produto editado com sucesso!",c.style.color="green",setTimeout(l,1e3)}catch{c.textContent="Erro ao editar produto.",c.style.color="red"}})}async function w(e){try{const o=await fetch(`https://store-management-system-xemr.onrender.com/api/product/${e}/desactivate`,{method:"PATCH",headers:{Authorization:`Bearer ${d}`}}),t=await o.json();if(!o.ok){alert(t.message||"Erro ao eliminar produto.");return}alert(t.message||"Produto eliminado com sucesso!"),await l()}catch{alert("Erro ao eliminar produto.")}}n.addEventListener("submit",async e=>{e.preventDefault(),i.textContent="";const o=n.name.value.trim(),t=n.price.value.trim(),r=n.stock_quantity.value.trim(),a=n.category_id.value;if(!o||!t||!r||!a){i.textContent="Todos os campos são obrigatórios.",i.style.color="red";return}try{const s=await fetch("https://store-management-system-xemr.onrender.com/api/product/new",{method:"POST",headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json"},body:JSON.stringify({name:o,price:t,stock_quantity:r,category_id:a})}),u=await s.json();if(!s.ok){i.textContent=u.message||"Erro ao criar produto.",i.style.color="red";return}i.textContent=u.message||"Produto criado com sucesso!",i.style.color="green",n.reset(),b(),await l()}catch{i.textContent="Erro ao criar produto.",i.style.color="red"}});function b(){const e=n.querySelector('input[name="category_id"]');e&&e.remove();const o=n.querySelector(".categoria-select-div");o&&o.remove();const t=n.querySelector('button[type="submit"]'),r=document.createElement("div");r.className="categoria-select-div",r.innerHTML=`<label>Categoria: ${h()}</label><br>`,n.insertBefore(r,t)}(async()=>(await E(),b(),l()))()});
